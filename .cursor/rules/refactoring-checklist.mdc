---
alwaysApply: true
---
# Refactoring Checklist for Large Files

Use when ANY file exceeds 80 lines.

## Pre-Refactoring Assessment

- [ ] File >80 lines or will exceed 100 lines
- [ ] Multiple responsibilities (violates SRP)
- [ ] Repeated code patterns (violates DRY)

**If ANY checked: Proceed with refactoring**

## Step 1: Analyze & Plan

- [ ] List all functions/classes in file
- [ ] Group by responsibility (UI, logic, API, utils)
- [ ] Note dependencies between groups
- [ ] Create subfolder: `filename/` or `feature/`
- [ ] Define descriptive module names

**Good module names:** `ui.js`, `handlers.js`, `api-client.js`, `validators.js`
**Bad module names:** `utils.js`, `helpers.js`, `misc.js`, `stuff.js`

Example:
```
popup.js (200 lines) → Split to:
  popup.js (40 lines - orchestrator)
  popup/ui.js (80 lines)
  popup/handlers.js (90 lines)
```

## Step 2: Create Modules

- [ ] Create subfolder and module files
- [ ] Move relevant code to each module
- [ ] Add exports: `export function name() {}`
- [ ] Add JSDoc for public APIs

## Step 3: Update Main File

- [ ] Remove extracted code
- [ ] Add imports: `import { func } from './module.js';`
- [ ] Wire modules together (thin orchestrator)
- [ ] Verify main file ≤100 lines

## Step 4: Verify Quality

- [ ] Each module has single responsibility
- [ ] No circular dependencies
- [ ] Each module ≤100 lines
- [ ] All files ≤100 lines
- [ ] No duplicate code (DRY)
- [ ] Clear module names

## Step 5: Test & Document

- [ ] Run tests
- [ ] Manually test features
- [ ] Check console for errors
- [ ] Verify imports resolve
- [ ] Update README if needed
- [ ] Document module relationships

## Red Flags

- Module >100 lines → Split further
- Multiple responsibilities → Split by concern
- Circular imports → Redesign dependencies
- Too many imports → Missing abstraction layer
- Unclear names → Rethink boundaries

## Common Patterns

**Extract UI:** `app.js (250)` → `app.js (60)` + `app/ui.js (90)`
**Extract Handlers:** `main.js (180)` → `main.js (40)` + `main/handlers.js (95)` + `main/logic.js (85)`
**Extract API:** `service.js (220)` → `service.js (50)` + `service/api.js (80)` + `service/transform.js (70)`

## Success Criteria

- All files ≤100 lines
- One clear purpose per file
- No code duplication
- Clean import structure
- Tests pass
