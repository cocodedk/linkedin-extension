---
description: Step-by-step refactoring checklist for large files
---

# Refactoring Checklist for Large Files

Use this checklist when ANY file exceeds 80 lines.

## Pre-Refactoring Assessment

- [ ] File currently has >80 lines
- [ ] File will exceed 100 lines with planned changes
- [ ] File has multiple responsibilities (violates SRP)
- [ ] File contains repeated code patterns (violates DRY)

**If ANY box checked: Proceed with refactoring**

## Step 1: Analyze Current Structure

### Identify Logical Boundaries
- [ ] List all functions/classes in the file
- [ ] Group by responsibility (UI, logic, API, utils)
- [ ] Note dependencies between groups
- [ ] Mark shared/common code

### Example Analysis
```
popup.js (200 lines):
  - DOM manipulation (50 lines) â†’ ui.js
  - Event handlers (80 lines) â†’ handlers.js  
  - Chrome API calls (40 lines) â†’ chrome-utils.js
  - Helper functions (30 lines) â†’ utils.js
```

## Step 2: Plan Module Structure

- [ ] Create subfolder: `filename/` or `feature/`
- [ ] Define module names (be descriptive)
- [ ] Map functions to modules
- [ ] Identify shared dependencies

### Naming Conventions
```
âœ… Good Module Names:
  - ui.js (UI rendering)
  - handlers.js (event handlers)
  - api-client.js (API calls)
  - validators.js (validation logic)
  - constants.js (configuration)

âŒ Bad Module Names:
  - utils.js (too generic)
  - helpers.js (unclear purpose)
  - misc.js (dumping ground)
  - stuff.js (meaningless)
```

## Step 3: Create Module Files

- [ ] Create subfolder
- [ ] Create module files
- [ ] Copy relevant code to each module
- [ ] Add proper exports to each module
- [ ] Add JSDoc/comments for public APIs

### Module Template
```javascript
/**
 * [Module name and purpose]
 */

// Imports
import { dependency } from './other-module.js';

// Constants (if any)
const LOCAL_CONST = 'value';

// Main exports
export function mainFunction() {
  // Implementation
}

export function helperFunction() {
  // Implementation
}

// Default export (if needed)
export default mainFunction;
```

## Step 4: Update Main File

- [ ] Remove extracted code from main file
- [ ] Add imports for new modules
- [ ] Wire modules together
- [ ] Keep main file as thin orchestrator
- [ ] Verify main file is â‰¤100 lines

### Main File Template
```javascript
/**
 * Main orchestrator - wires together modules
 */

// Module imports
import { ui } from './feature/ui.js';
import { handlers } from './feature/handlers.js';
import { utils } from './feature/utils.js';

// Initialize and export
export function init() {
  ui.render();
  handlers.attach();
}

// Export main entry point
export default init;
```

## Step 5: Verify Module Boundaries

- [ ] Each module has single responsibility
- [ ] No circular dependencies
- [ ] Clear import/export interfaces
- [ ] Minimal coupling between modules
- [ ] Each module is â‰¤100 lines

### Check Module Quality
```javascript
// âœ… Good: Clear responsibility
// ui.js - only UI rendering
// handlers.js - only event handling

// âŒ Bad: Mixed responsibilities  
// stuff.js - UI + handlers + API calls
```

## Step 6: Test Refactored Code

- [ ] Run existing tests
- [ ] Manually test all features
- [ ] Check browser console for errors
- [ ] Verify imports resolve correctly
- [ ] Test in both Chrome and Firefox (if applicable)

## Step 7: Update Documentation

- [ ] Update README if structure changed
- [ ] Add module documentation
- [ ] Update import examples
- [ ] Document module relationships
- [ ] Add architecture diagram (if complex)

## Step 8: Final Verification

- [ ] All files are â‰¤100 lines
- [ ] No duplicate code (DRY)
- [ ] Single responsibility per module (SRP)
- [ ] Clear module names
- [ ] Proper imports/exports
- [ ] Tests pass
- [ ] Documentation updated

## Common Refactoring Patterns

### Pattern 1: Extract UI Layer
```
Before: app.js (250 lines - logic + UI)
After:  app.js (60 lines - logic only)
        app/ui.js (90 lines - UI only)
```

### Pattern 2: Extract Handlers
```
Before: main.js (180 lines - mixed)
After:  main.js (40 lines - initialization)
        main/handlers.js (95 lines - event handlers)
        main/logic.js (85 lines - business logic)
```

### Pattern 3: Extract API Layer
```
Before: service.js (220 lines - mixed)
After:  service.js (50 lines - main logic)
        service/api.js (80 lines - API calls)
        service/transform.js (70 lines - data transformation)
```

### Pattern 4: Extract Utilities
```
Before: controller.js (300 lines)
After:  controller.js (70 lines)
        controller/validators.js (60 lines)
        controller/formatters.js (55 lines)
        controller/helpers.js (75 lines)
```

## Red Flags During Refactoring

ðŸš¨ Module still >100 lines â†’ Split further
ðŸš¨ Module has multiple responsibilities â†’ Split by concern
ðŸš¨ Circular imports â†’ Redesign dependencies
ðŸš¨ Too many imports in main file â†’ Missing abstraction layer
ðŸš¨ Unclear module names â†’ Rethink boundaries

## Success Criteria

âœ… All files â‰¤100 lines
âœ… Each file has one clear purpose
âœ… No code duplication
âœ… Clean import structure
âœ… Tests pass
âœ… Easy to understand
âœ… Easy to modify

**If all criteria met: Commit and celebrate! ðŸŽ‰**
